import os
import pathlib
import re
import pymupdf
from loguru import logger

# –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ª–∞—Ç–∏–Ω—Å–∫–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ —Å –¥–∏–∞–∫—Ä–∏—Ç–∏–∫–æ–π —Ä—É—Å—Å–∫–∏–º —Å–∏–º–≤–æ–ª–∞–º
# –≠—Ç–æ—Ç —Å–ª–æ–≤–∞—Ä—å —Å–æ—Å—Ç–∞–≤–ª–µ–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π –∑–∞ —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–∞–º–µ–Ω–∞–º–∏ –≤ PDF-—Ñ–∞–π–ª–∞—Ö
LATIN_TO_CYRILLIC = {
    # –ó–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã
    '√Ä': '–ê', '√Å': '–ë', '√Ç': '–í', '√É': '–ì', '√Ñ': '–î', '√Ö': '–ï',
    '√Ü': '–ñ', '√á': '–ó',
    '√à': '–ò', '√â': '–ô', '√ä': '–ö', '√ã': '–õ',
    '√å': '–ú', '√ç': '–ù', '√é': '–û', '√è': '–ü',
    '√ê': '–†', '√ë': '–°', '√í': '–¢', '√ì': '–£', '√î': '–§', '√ï': '–•', '√ñ': '–¶',
    '√ó': '–ß', '√ò': '–®', '√ô': '–©', '√ö': '–™', '√õ': '–´', '√ú': '–¨',
    '√ù': '–≠', '√û': '–Æ', '√ü': '–Ø',
    
    # –°—Ç—Ä–æ—á–Ω—ã–µ –±—É–∫–≤—ã
    '√†': '–∞', '√°': '–±', '√¢': '–≤', '√£': '–≥', '√§': '–¥', '√•': '–µ',
    '√¶': '–∂', '√ß': '–∑',
    '√®': '–∏', '√©': '–π', '√™': '–∫', '√´': '–ª',
    '√¨': '–º', '√≠': '–Ω', '√Æ': '–æ', '√Ø': '–ø',
    '√∞': '—Ä', '√±': '—Å', '√≤': '—Ç', '√≥': '—É', '√¥': '—Ñ', '√µ': '—Ö', '√∂': '—Ü',
    '√∑': '—á', '√∏': '—à', '√π': '—â', '√∫': '—ä', '√ª': '—ã', '√º': '—å',
    '√Ω': '—ç', '√æ': '—é', '√ø': '—è',
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã, —á–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞—é—â–∏–µ—Å—è –≤ PDF
    '¬∫': '–æ', '¬π': '–∏', '¬≤': '–µ', '¬≥': '–∞',
    '¬∞': '–æ', '¬±': '–∏',
    '¬º': '—á', '¬Ω': '—à', '¬æ': '—å',
    '¬µ': '–º', '¬ø': '—è',
    '¬Æ': '—Ä', '¬©': '—Å',
    '¬¢': '—Ü', '¬£': '–ª',
    '¬§': '–¥', '¬•': '—ç',
    '¬¶': '–∏', '¬ß': '–ø',
    '¬®': '–µ', '¬´': '–∫',
    '¬¨': '–Ω', '¬≠': '—Ç',
    '¬Ø': '–≤', '¬∑': '–±',
    '¬ª': '—é', '¬™': '–∂',
    
    # –ß–∏—Å–ª–∞, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω—ã
    '¬°': '1', '¬¢': '2', '¬£': '3', '¬§': '4', '¬•': '5',
    '¬¶': '6', '¬ß': '7', '¬®': '8', '¬©': '9', '¬™': '0',
    
    # –î—Ä—É–≥–∏–µ —Å–∏–º–≤–æ–ª—ã
    '—ë': '—ë', '–Å': '–Å',  # –Å —á–∞—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å
    '‚Äì': '-', '‚Äî': '-',  # –†–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏—Ä–µ
    '‚Ññ': '‚Ññ',            # –ó–Ω–∞–∫ –Ω–æ–º–µ—Ä–∞
    '‚Ä¶': '...',          # –ú–Ω–æ–≥–æ—Ç–æ—á–∏–µ
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã —Å –¥–∏–∞–∫—Ä–∏—Ç–∏–∫–æ–π
    'ƒÉ': '–∞', 'ƒÖ': '–∞', 'ƒá': '—Å', 'ƒç': '—á', 'ƒè': '–¥', 
    'ƒì': '–µ', 'ƒï': '–µ', 'ƒó': '–µ', 'ƒô': '–µ', 'ƒõ': '–µ',
    'ƒü': '–≥', 'ƒ£': '–≥', 'ƒ´': '–∏', 'ƒ≠': '–∏', 'ƒØ': '–∏',
    'ƒ∑': '–∫', 'ƒ∫': '–ª', 'ƒº': '–ª', 'ƒæ': '–ª', '≈Ç': '–ª',
    '≈Ñ': '–Ω', '≈Ü': '–Ω', '≈à': '–Ω', '≈ç': '–æ', '≈è': '–æ',
    '≈ë': '–æ', '≈ì': '—ç', '≈ï': '—Ä', '≈ô': '—Ä', '≈õ': '—Å',
    '≈ü': '—Å', '≈°': '—à', '≈£': '—Ç', '≈•': '—Ç', '≈´': '—É',
    '≈≠': '—É', '≈Ø': '—É', '≈±': '—É', '≈≥': '—É', '≈∫': '–∑',
    '≈º': '–∂', '≈æ': '–∂',
    
    # –ó–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã —Å –¥–∏–∞–∫—Ä–∏—Ç–∏–∫–æ–π
    'ƒÇ': '–ê', 'ƒÑ': '–ê', 'ƒÜ': '–°', 'ƒå': '–ß', 'ƒé': '–î', 
    'ƒí': '–ï', 'ƒî': '–ï', 'ƒñ': '–ï', 'ƒò': '–ï', 'ƒö': '–ï',
    'ƒû': '–ì', 'ƒ¢': '–ì', 'ƒ™': '–ò', 'ƒ¨': '–ò', 'ƒÆ': '–ò',
    'ƒ∂': '–ö', 'ƒπ': '–õ', 'ƒª': '–õ', 'ƒΩ': '–õ', '≈Å': '–õ',
    '≈É': '–ù', '≈Ö': '–ù', '≈á': '–ù', '≈å': '–û', '≈é': '–û',
    '≈ê': '–û', '≈í': '–≠', '≈î': '–†', '≈ò': '–†', '≈ö': '–°',
    '≈û': '–°', '≈†': '–®', '≈¢': '–¢', '≈§': '–¢', '≈™': '–£',
    '≈¨': '–£', '≈Æ': '–£', '≈∞': '–£', '≈≤': '–£', '≈π': '–ó',
    '≈ª': '–ñ', '≈Ω': '–ñ',
    
    # –°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ —Å–ª—É—á–∞–∏ –¥–ª—è –±—é–ª–ª–µ—Ç–µ–Ω–µ–π
    'o': '–æ', 'O': '–û',  # –õ–∞—Ç–∏–Ω—Å–∫–∏–µ o/O —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–º–µ—Å—Ç–æ –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏—Ö
    'e': '–µ', 'E': '–ï',  # –õ–∞—Ç–∏–Ω—Å–∫–∏–µ e/E —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–º–µ—Å—Ç–æ –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏—Ö
    'p': '—Ä', 'P': '–†',  # –õ–∞—Ç–∏–Ω—Å–∫–∏–µ p/P —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–º–µ—Å—Ç–æ –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏—Ö
    'a': '–∞', 'A': '–ê',  # –õ–∞—Ç–∏–Ω—Å–∫–∏–µ a/A —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–º–µ—Å—Ç–æ –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏—Ö
    'c': '—Å', 'C': '–°',  # –õ–∞—Ç–∏–Ω—Å–∫–∏–µ c/C —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–º–µ—Å—Ç–æ –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏—Ö
    'x': '—Ö', 'X': '–•',  # –õ–∞—Ç–∏–Ω—Å–∫–∏–µ x/X —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–º–µ—Å—Ç–æ –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏—Ö
    'y': '—É', 'Y': '–£',  # –õ–∞—Ç–∏–Ω—Å–∫–∏–µ y/Y —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–º–µ—Å—Ç–æ –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏—Ö
    'B': '–í',            # –õ–∞—Ç–∏–Ω—Å–∫–∞—è B —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–æ–π –í
    'H': '–ù',            # –õ–∞—Ç–∏–Ω—Å–∫–∞—è H —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–æ–π –ù
    'K': '–ö',            # –õ–∞—Ç–∏–Ω—Å–∫–∞—è K —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–æ–π –ö
    'M': '–ú',            # –õ–∞—Ç–∏–Ω—Å–∫–∞—è M —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–æ–π –ú
    'T': '–¢',            # –õ–∞—Ç–∏–Ω—Å–∫–∞—è T —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–æ–π –¢
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–º–µ–Ω—ã –ª–∞—Ç–∏–Ω—Å–∫–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞ –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏–µ
def replace_latin_with_cyrillic(text):
    """
    –ó–∞–º–µ–Ω—è–µ—Ç –ª–∞—Ç–∏–Ω—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã —Å –¥–∏–∞–∫—Ä–∏—Ç–∏–∫–æ–π –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ä—É—Å—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã.
    """
    # –°–æ–∑–¥–∞–µ–º —à–∞–±–ª–æ–Ω —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –∫–ª—é—á–µ–π —Å–ª–æ–≤–∞—Ä—è
    pattern = re.compile('|'.join(map(re.escape, LATIN_TO_CYRILLIC.keys())))
    
    # –ó–∞–º–µ–Ω—è–µ–º –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
    return pattern.sub(lambda m: LATIN_TO_CYRILLIC[m.group(0)], text)

# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ –≤ —Ç–µ–∫—Å—Ç–µ –ø–æ—Å–ª–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
def fix_common_errors(text):
    """
    –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤ —Ç–µ–∫—Å—Ç–µ –ø–æ—Å–ª–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∏–∑ PDF.
    """
    # –ó–∞–º–µ–Ω–∞ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å–∏–º–≤–æ–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–æ–æ" -> "–æ")
    text = re.sub(r'([–∞-—è–ê-–Ø—ë–Å])\1{2,}', r'\1\1', text)
    
    # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞—é—â–∏—Ö—Å—è –æ—à–∏–±–æ–∫ –≤ —Å–ª–æ–≤–∞—Ö
    replacements = [
        (r'\b–∏—Å–∑–≤–µ—Å—Ç–∏—è\b', '–∏–∑–≤–µ—Å—Ç–∏—è'),
        (r'\b–∏—Å–±—Ä–∞–Ω–Ω—ã–µ\b', '–∏–∑–±—Ä–∞–Ω–Ω—ã–µ'),
        (r'\b—Ä–∞–∑–¥–∏–ª–µ–Ω–∏–µ\b', '—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ'),
        (r'\b–∏—Å–ø–æ–ª—å–∑–∏–µ–≤–∞–Ω–∏–µ\b', '–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ'),
        (r'\b–∏–∞–ª–∞—Å—Ç–Ω–∏–≥–∏\b', '–æ–±–ª–∞—Å—Ç–Ω–æ–≥–æ'),
        (r'\b–ø—Ä–∞–¥—Å–∞–¥–∞—Ç–∞–ª—å\b', '–ø—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—å'),
        (r'\b–≤—ã—Å—Ç–æ–ø–∏–ª–∞\b', '–≤—ã—Å—Ç—É–ø–∏–ª–∞'),
        (r'\b–¥–∏–∫–ª–∞–¥–∏–º\b', '–¥–æ–∫–ª–∞–¥–æ–º'),
        # –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ —Ç–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏
    ]
    
    for pattern, replacement in replacements:
        text = re.sub(pattern, replacement, text)
    
    return text

def convert_pdf_to_text(input_pdf_path: str, output_txt_path: str) -> None:
    """
    –ß–∏—Ç–∞–µ—Ç PDF –ø–æ –ø—É—Ç–∏ input_pdf_path –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ —Ç–µ–∫—Å—Ç –≤ output_txt_path.
    
    Args:
        input_pdf_path: –ü—É—Ç—å –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É PDF-—Ñ–∞–π–ª—É
        output_txt_path: –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
    """
    try:
        logger.info(f"–ù–∞—á–∏–Ω–∞–µ–º –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é —Ñ–∞–π–ª–∞ {input_pdf_path} ‚Üí {output_txt_path}")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ñ–∞–π–ª –±—é–ª–ª–µ—Ç–µ–Ω–µ–º
        is_bulletin = '–±—é–ª–ª–µ—Ç–µ–Ω—å' in input_pdf_path.lower()
        
        # –û—Ç–∫—Ä—ã–≤–∞–µ–º PDF-–¥–æ–∫—É–º–µ–Ω—Ç —Å –ø–æ–º–æ—â—å—é PyMuPDF
        with pymupdf.open(input_pdf_path) as doc:
            text_pages = []
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞
            for page_num in range(len(doc)):
                page = doc.load_page(page_num)
                
                if is_bulletin:
                    # –î–ª—è –±—é–ª–ª–µ—Ç–µ–Ω–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
                    text = page.get_text("text", flags=pymupdf.TEXT_PRESERVE_LIGATURES | 
                                                 pymupdf.TEXT_PRESERVE_WHITESPACE | 
                                                 pymupdf.TEXT_DEHYPHENATE |
                                                 pymupdf.TEXT_PRESERVE_SPANS)
                    
                    # –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∑–∞–º–µ–Ω—ã –ª–∞—Ç–∏–Ω—Å–∫–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞ –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏–µ
                    text = replace_latin_with_cyrillic(text)
                    
                    # –ò—Å–ø—Ä–∞–≤–ª—è–µ–º —Ç–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤ —Ç–µ–∫—Å—Ç–µ
                    text = fix_common_errors(text)
                    
                    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –±—é–ª–ª–µ—Ç–µ–Ω–µ–π
                    # –£–¥–∞–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –ø—Ä–æ–±–µ–ª—ã –∏ –ª–∏—à–Ω–∏–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                    text = re.sub(r'\s+', ' ', text)
                    text = re.sub(r'\n\s*\n', '\n\n', text)
                    
                    # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–±–∑–∞—Ü—ã, –æ–±—ä–µ–¥–∏–Ω—è—è –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
                    text = re.sub(r'(\w)-\s+(\w)', r'\1\2', text)
                else:
                    # –î–ª—è –æ–±—ã—á–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                    text = page.get_text()
                
                text_pages.append(text)
            
            # –û–±—ä–µ–¥–∏–Ω—è–µ–º —Ç–µ–∫—Å—Ç –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
            full_text = "\n".join(text_pages)
            
            # –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            os.makedirs(os.path.dirname(output_txt_path), exist_ok=True)
            
            # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ —Ñ–∞–π–ª
            with open(output_txt_path, 'w', encoding='utf-8') as f:
                f.write(full_text)
            
            logger.info(f"–§–∞–π–ª {output_txt_path} —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω")
            
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ñ–∞–π–ª–∞ {input_pdf_path}: {str(e)}")

def process_all_pdfs(input_dir: str, output_dir: str) -> None:
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ PDF-—Ñ–∞–π–ª—ã –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö.
    
    Args:
        input_dir: –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –∏—Å—Ö–æ–¥–Ω—ã–º–∏ PDF-—Ñ–∞–π–ª–∞–º–∏
        output_dir: –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤
    """
    # –°–æ–∑–¥–∞–µ–º –≤—ã—Ö–æ–¥–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    os.makedirs(output_dir, exist_ok=True)
    
    # –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ PDF-—Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    pdf_files = [f for f in os.listdir(input_dir) if f.lower().endswith('.pdf')]
    
    logger.info(f"–í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ {len(pdf_files)} PDF-—Ñ–∞–π–ª–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
    processed_files = set()
    if os.path.exists(output_dir):
        processed_files = {f for f in os.listdir(output_dir) if f.lower().endswith('.txt')}
        processed_files = {os.path.splitext(f)[0] for f in processed_files}  # –£–±–∏—Ä–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
    
    logger.info(f"üìä –£–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: {len(processed_files)} —Ñ–∞–π–ª–æ–≤")
    
    # –§–∏–ª—å—Ç—Ä—É–µ–º —Ñ–∞–π–ª—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
    files_to_process = []
    skipped_files = []
    
    for pdf_file in pdf_files:
        pdf_name = os.path.splitext(pdf_file)[0]
        output_path = os.path.join(output_dir, pdf_name + '.txt')
        
        if pdf_name in processed_files or os.path.exists(output_path):
            skipped_files.append(pdf_file)
        else:
            files_to_process.append(pdf_file)
    
    logger.info(f"üìä –ü—Ä–æ–ø—É—â–µ–Ω–æ (—É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ): {len(skipped_files)} —Ñ–∞–π–ª–æ–≤")
    logger.info(f"üìä –ë—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: {len(files_to_process)} —Ñ–∞–π–ª–æ–≤")
    
    if not files_to_process:
        logger.info("‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã!")
        return
    
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã
    processed_count = 0
    for pdf_file in files_to_process:
        input_path = os.path.join(input_dir, pdf_file)
        output_path = os.path.join(output_dir, os.path.splitext(pdf_file)[0] + '.txt')
        
        logger.info(f"üìÑ –û–±—Ä–∞–±–æ—Ç–∫–∞: {pdf_file}")
        convert_pdf_to_text(input_path, output_path)
        
        if os.path.exists(output_path):
            processed_count += 1
    
    logger.info(f"‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")
    logger.info(f"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:")
    logger.info(f"   ‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: {processed_count} –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤")
    logger.info(f"   ‚è≠Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω–æ (—É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ): {len(skipped_files)} —Ñ–∞–π–ª–æ–≤")
    logger.info(f"   üìÅ –í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ: {len(pdf_files)} —Ñ–∞–π–ª–æ–≤")

if __name__ == "__main__":
    import argparse
    
    parser = argparse.ArgumentParser(description='–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä PDF –≤ —Ç–µ–∫—Å—Ç')
    parser.add_argument('--input-dir', help='–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –∏—Å—Ö–æ–¥–Ω—ã–º–∏ PDF-—Ñ–∞–π–ª–∞–º–∏')
    parser.add_argument('--output-dir', help='–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤')
    parser.add_argument('--input-file', help='–û—Ç–¥–µ–ª—å–Ω—ã–π PDF —Ñ–∞–π–ª –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏')
    
    args = parser.parse_args()
    
    if args.input_file:
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
        if not args.output_dir:
            parser.error("--output-dir —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ --input-file")
        
        output_path = os.path.join(args.output_dir, os.path.splitext(os.path.basename(args.input_file))[0] + '.txt')
        convert_pdf_to_text(args.input_file, output_path)
    elif args.input_dir and args.output_dir:
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
        process_all_pdfs(args.input_dir, args.output_dir) 
    else:
        parser.error("–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –ª–∏–±–æ --input-file –∏ --output-dir, –ª–∏–±–æ --input-dir –∏ --output-dir") 